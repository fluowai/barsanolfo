// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// LEADS - Contatos do formulário
model Lead {
  id        String   @id @default(uuid())
  name      String
  email     String
  phone     String
  type      String   // rescisao, horas, assedio, outro
  message   String
  source    String   @default("WEBSITE")
  status    String   @default("NEW") // NEW, CONTACTED, QUALIFIED, CONVERTED, LOST
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("leads")
}

// USUÁRIOS - Sistema de autenticação
model User {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String @map("password_hash")
  name         String
  role         String   @default("LAWYER") // ADMIN, LAWYER, SECRETARY
  avatar       String?
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relações
  cases        Case[]
  tasks        Task[]

  @@map("users")
}

// CLIENTES - Gestão de clientes
model Client {
  id        String   @id @default(uuid())
  name      String
  cpf       String?  @unique
  rg        String?
  email     String
  phone     String
  address   String?
  notes     String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relações
  cases     Case[]
  contracts Contract[]

  @@map("clients")
}

// PROCESSOS
model Case {
  id           String     @id @default(uuid())
  number       String     @unique
  type         String     // TRABALHISTA, CIVEL, etc
  court        String?
  status       String     @default("ACTIVE") // ACTIVE, SUSPENDED, ARCHIVED, CLOSED
  value        Float?
  filedDate    DateTime? @map("filed_date")
  clientId     String    @map("client_id")
  lawyerId     String    @map("lawyer_id")
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")

  // Relações
  client       Client     @relation(fields: [clientId], references: [id])
  lawyer       User       @relation(fields: [lawyerId], references: [id])
  movements    CaseMovement[]
  deadlines    Deadline[]
  hearings     Hearing[]

  @@map("cases")
}

// MOVIMENTAÇÕES PROCESSUAIS
model CaseMovement {
  id          String   @id @default(uuid())
  caseId      String   @map("case_id")
  date        DateTime
  description String
  type        String?
  createdAt   DateTime @default(now()) @map("created_at")

  case        Case     @relation(fields: [caseId], references: [id])

  @@map("case_movements")
}

// PRAZOS
model Deadline {
  id          String   @id @default(uuid())
  caseId      String   @map("case_id")
  description String
  dueDate     DateTime @map("due_date")
  completed   Boolean  @default(false)
  createdAt   DateTime @default(now()) @map("created_at")

  case        Case     @relation(fields: [caseId], references: [id])

  @@map("deadlines")
}

// AUDIÊNCIAS
model Hearing {
  id        String   @id @default(uuid())
  caseId    String   @map("case_id")
  date      DateTime
  location  String?
  type      String
  notes     String?
  createdAt DateTime @default(now()) @map("created_at")

  case      Case     @relation(fields: [caseId], references: [id])

  @@map("hearings")
}

// TAREFAS
model Task {
  id          String   @id @default(uuid())
  title       String
  description String?
  dueDate     DateTime? @map("due_date")
  status      String   @default("TODO") // TODO, IN_PROGRESS, DONE, CANCELLED
  priority    String   @default("MEDIUM") // LOW, MEDIUM, HIGH, URGENT
  assignedTo  String   @map("assigned_to")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  user        User     @relation(fields: [assignedTo], references: [id])

  @@map("tasks")
}

// FINANCEIRO - CONTRATOS
model Contract {
  id            String   @id @default(uuid())
  clientId      String   @map("client_id")
  type          String   // FIXED_FEE, PERCENTAGE, etc
  value         Float
  paymentMethod String?  @map("payment_method")
  signedDate    DateTime? @map("signed_date")
  createdAt     DateTime @default(now()) @map("created_at")

  client        Client   @relation(fields: [clientId], references: [id])
  invoices      Invoice[]

  @@map("contracts")
}

// FATURAS
model Invoice {
  id         String    @id @default(uuid())
  contractId String    @map("contract_id")
  amount     Float
  dueDate    DateTime  @map("due_date")
  paidDate   DateTime? @map("paid_date")
  status     String    @default("PENDING") // PENDING, PAID, OVERDUE, CANCELLED
  createdAt  DateTime  @default(now()) @map("created_at")

  contract   Contract  @relation(fields: [contractId], references: [id])

  @@map("invoices")
}

// DESPESAS
model Expense {
  id          String   @id @default(uuid())
  description String
  amount      Float
  category    String?
  date        DateTime
  createdAt   DateTime @default(now())

  @@map("expenses")
}
// CONFIGURAÇÕES DE IA
model AIConfig {
  id        String   @id @default(uuid())
  provider  String   // GEMINI, OPENAI, etc
  apiKey    String
  model     String?
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("ai_configs")
}
